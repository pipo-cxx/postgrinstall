# Postgrinstall
<br>
**Postgrinstall** - небольшая программа для установки PostgreSQL на менее загруженный из двух серверов с операционными системами Debian и AlmaLinux.<br><br>
Программа создана для запуска на Linux. Её запуск на Windows не тестировался и не поддерживается.

## Перед запуском

1. Создайте пару ключей ssh и назовите ключ, которым будете подключаться к серверам, `ansible_key`. Убедитесь, что оба ключа находятся в домашней директории пользователя, который будет запускать скрипт, в папке `.ssh`.<br><br>
2. Настройте подключение по ssh к двум необходимым серверам. Проверьте, что хост, с которого будет запускаться программа, может к ним подключиться как пользователь `root` по ключу и без ввода пароля.<br><br>
3. Проверьте, что у всех машин есть доступ в интернет для скачивания необходимых пакетов.<br>

## Запуск

1. Установите `Python 3` и `Ansible` по официальным инструкциям.

2. Клонируйте репозиторий командой:
```git clone ```

3. Перейдите в папку с клонированным репозиторием.

4. Создайте виртуальную среду Python, например:
```python3 -m venv .env```

5. Запустите `pip` внутри этой среды и установите необходимые модули Python:
```.env/bin/pip install -r requirements.txt```

6. Запустите файл `main.py` с помощью интерпретатора Python созданной виртуальной среды:
```.env/bin/python main.py <ip_address_1>,<ip_address_2>```

Замените <ip_address_1> и <ip_address_2> на необходимые адреса/доменные имена.

7. С этого момента всё автоматизировано.<br><br>
Скриншоты с примером выполнения данной программы:

<br>

## Возникшие сложности

* Первой из сложностей было незнание Ansible. После получения задания его пришлось изучать, однако инструмент оказался несложным, с хорошей документацией и был быстро освоен.

* Далее, возникли проблемы с "родными" пакетами дистрибутивов. Каждый дистрибутив (AlmaLinux, Debian) в своих репозиториях имел странно переделанную (Debian) или не предпочитаемую на официальном сайте PostgreSQL (AlmaLinux) версию. Сперва, для упрощения, была предпринята попытка работать именно с этими пакетами, что отняло много времени и не дало никаких результатов из-за расхождений с документацией.<br>
В итоге было решено использовать пакеты из официальных репозиториев PostgreSQL, которые соответствовали документации проекта, и с которыми оказалось проще работать.

* Последней возникшей сложностью было переключение пользователя и запуск команд для базы данных через `psql`. А именно, передача утилите пароля создаваемого по умолчанию пользователя postgres. Были попытки выполнить это через `su`, передавать пароль через переменные среды и команду `echo`, но безуспешно.<br>
В результате изучения документации к утилите и переменным окружения, был обнаружен ещё один способ передачи пароля, который сработал и используется в программе, через файл паролей `.pgpass`.

* Также хочется отметить интересную формулировку задания. В требованиях указано, что необходимо использовать bash, ansible, python. Само же задание можно решить, пользуясь только bash и ansible или только python и ansible. Однако, чтобы не рисковать и точно пройти по критериям задания (а также продемонстрировать навыки), были использованы все три инструмента.